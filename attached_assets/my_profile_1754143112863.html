<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - CineRate</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style_hp.css">
    <style>
        .profile-pic {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #fff;
        }
        .profile-pic-upload {
            display: none;
        }
        .profile-pic-label {
            cursor: pointer;
            color: #fff;
            text-decoration: underline;
        }
        .card.bg-secondary.bg-opacity-10, .card.bg-secondary.bg-opacity-10 * {
            color: #fff !important;
        }
        .form-label, .form-control, .btn, h5, label, input, textarea, strong, span, p, a {
            color: #fff !important;
        }
        .text-warning {
            color: #ffc107 !important;
        }
        .user-review-card {
            display: flex;
            align-items: center;
            background: rgba(30,30,30,0.85);
            border-radius: 10px;
            margin-bottom: 1rem;
            padding: 0.7rem 1rem;
            box-shadow: 0 2px 8px #00000033;
        }
        .user-review-poster {
            width: 60px;
            height: 90px;
            object-fit: cover;
            border-radius: 7px;
            margin-right: 1rem;
            border: 2px solid #fff;
        }
        .user-review-fields strong, .user-review-fields span, .user-review-fields p {
            font-size: 1.08rem;
        }
        .user-review-fields strong {
            color: #ffc107;
            font-size: 1.15rem;
        }
        .user-review-fields span.text-warning {
            font-size: 1.08rem;
        }
        .user-review-fields {
            flex: 1;
        }
        .form-control#username, .form-control#password {
            color: #111 !important;
            background-color: #fff !important;
        }
        /* Back button hover effect */
        a.btn.btn-outline-light:hover, a.btn.btn-outline-light:focus {
            color: #111 !important;
            border-color: #111 !important;
            background: #fff !important;
        }
        a.btn.btn-outline-light:hover .fa-arrow-left, a.btn.btn-outline-light:focus .fa-arrow-left {
            color: #111 !important;
        }
    </style>
</head>
<body class="bg-dark text-dark">
    <div class="container py-5">
        <a href="home_page.html" class="btn btn-outline-light mb-4">
            <i class="fa fa-arrow-left"></i> Home page
        </a>
        <div class="card bg-secondary bg-opacity-10 p-4 mx-auto" style="max-width:500px;">
            <div class="text-center mb-3">
                <img src="profile_default.png" id="profilePic" class="profile-pic mb-2" alt="Profile Picture">
                <br>
                <label for="profilePicInput" class="profile-pic-label">Change profile picture</label>
                <input type="file" id="profilePicInput" class="profile-pic-upload" accept="image/*">
            </div>
            <form id="profileForm">
                <div class="mb-3">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input type="text" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary w-100 mb-3">Save Changes</button>
            </form>
            <h5 class="mt-4 mb-2">My Reviews</h5>
            <div id="userReviews"></div>
        </div>
    </div>
    <script>
        // Profile picture
        const profilePic = document.getElementById('profilePic');
        const profilePicInput = document.getElementById('profilePicInput');
        profilePicInput.onchange = function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(evt) {
                    profilePic.src = evt.target.result;
                    localStorage.setItem('profile_pic', evt.target.result);
                };
                reader.readAsDataURL(file);
            }
        };
        // Load saved profile pic
        const savedPic = localStorage.getItem('profile_pic');
        if (savedPic) profilePic.src = savedPic;

        // Username & password
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        // Load saved from login if exists
        if(localStorage.getItem('login_username')){
            usernameInput.value = localStorage.getItem('login_username');
        } else {
            usernameInput.value = localStorage.getItem('username') || 'Guest';
        }
        if(localStorage.getItem('login_password')){
            passwordInput.value = localStorage.getItem('login_password');
        } else {
            passwordInput.value = localStorage.getItem('password') || '';
        }
        document.getElementById('profileForm').onsubmit = function(e) {
            e.preventDefault();
            localStorage.setItem('username', usernameInput.value);
            localStorage.setItem('password', passwordInput.value);
            alert('Profile updated!');
        };

        // Show user reviews
        const userReviewsDiv = document.getElementById('userReviews');
        userReviewsDiv.innerHTML = '';
        // Map for movie poster lookup
        const posters = {
            "avatar": "/jRXYjXNq0Cs2TcJjLkki24MLp7u.jpg",
            "joker": "/udDclJoHjfjb8Ekgsd4FDteOkCU.jpg",
            "fight_club": "/a26cQPRhJPX6GbWfQbvZdrrp9j9.jpg",
            "f1": "/9PXZIUsSDh4alB80jheWX4fhZmy.jpg",
            "megan_2_0": "/oekamLQrwlJjRNmfaBE4llIvkir.jpg",
            "avengers_endgame": "/bR8ISy1O9XQxqiy0fQFw2BX72RQ.jpg"
        };
        function renderUserReviews() {
            userReviewsDiv.innerHTML = '';
            for (let key in localStorage) {
                if (key.endsWith('_review')) {
                    const review = JSON.parse(localStorage.getItem(key));
                    if (review && review.text && review.text.trim() !== "") {
                        let movieKey = key.replace('_review','').toLowerCase();
                        let poster = posters[movieKey] ? `https://image.tmdb.org/t/p/w500${posters[movieKey]}` : 'profile_default.png';
                        let movieName = movieKey.replace(/_/g,' ');
                        userReviewsDiv.innerHTML += `
                            <div class="user-review-card" data-review-key="${key}">
                                <img src="${poster}" class="user-review-poster" alt="${movieName} poster">
                                <div class="user-review-fields">
                                    <strong>${movieName.charAt(0).toUpperCase() + movieName.slice(1)}</strong><br>
                                    <span class="text-warning">Rating: ${review.rating ? review.rating : '-'}</span><br>
                                    <span>Review: ${review.text}</span>
                                </div>
                                <button class="btn btn-sm btn-danger ms-2 delete-review-btn"><i class="fa fa-trash"></i></button>
                            </div>
                        `;
                    }
                }
            }
            // Add delete functionality
            document.querySelectorAll('.delete-review-btn').forEach(btn => {
                btn.onclick = function() {
                    const reviewKey = this.closest('.user-review-card').getAttribute('data-review-key');
                    if (confirm('Are you sure you want to delete this review?')) {
                        localStorage.removeItem(reviewKey);
                        renderUserReviews();
                    }
                };
            });
        }
        renderUserReviews();
    </script>
</body>
</html>
